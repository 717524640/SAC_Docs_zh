\section{震相拾取}
\label{sec:phase-picking}

相关命令：\nameref{cmd:plotpk}

震相拾取是SAC中最常用的一个功能。

plotpk的用法很简单，但却是教程中最难解释的一部分。当在SAC中键入plotpk（简写为ppk）后，
即进入``ppk模式''。

\begin{SACCode}
SAC> fg seis
SAC> ppk        // 进入ppk模式
// 将光标置于绘图窗口上，键入"q"以退出ppk模式
SAC> wh
SAC> q
\end{SACCode}
此时会出现一个绘图窗口，且焦点位于绘图窗口上，SAC程序进入了ppk模式。

\begin{Tips}
在键入ppk命令后，SAC进入``ppk模式''。当焦点位于绘图窗口时，所有的键盘键入都被当成
``ppk模式''下的命令，这是``真ppk模式''；若焦点位于SAC终端中，此时所有的键盘键入
都会显示在终端中，这是``假ppk模式''。

``假ppk模式''下的所有键入都会被当前SAC命令去解释，但是由于SAC当前处于``ppk模式''，
所以命令并不会马上被解释，只有当退出``ppk模式''时，这些命令才会被解释。

接下来所说的``ppk模式''均表示``真ppk模式''。
\end{Tips}

移动光标到绘图窗口内部，光标会以特殊的``十字''形态出现。在``\nameref{sec:sac-install}''
一节中提到的\lstinline{SAC_PPK_USE_CROSSHAIRS}可以控制该光标的形态。用户可以自己设置
该环境变量为0或1，找到适合自己的光标形态。个人较推荐设置其值为1。

此时所有的键入都会解释成``ppk模式''下的命令，表\ref{table:plotpk-commands}列出了
``ppk模式''支持的所有命令。

``ppk模式''的命令几乎都是由单个字符组成的（唯一的例外是命令``t''，由字符``t''和0-9的
整数构成），每个命令都有相应的功能，同时也会产生一定的效果。

经常使用的包括``b''、``l''、``n''、``o''、``q''、``t''和``x''。

关于``x''，首先需要将光标移动到窗口的左侧某位置，键入``x''，再向右移动至某位置，
再次键入``x''，两次键入确定了一个时间窗，绘图窗口中将只显示该时间窗内的波形，
即X轴的放大，常用于查看波形的细节。可以不断重复此步骤，进行多次放大。

在某些版本下，可以不使用``x''，直接在左侧位置按下鼠标左键，拖动至右侧位置，再松开鼠标
左键，则该时间窗内的波形会被放大。

放大之后的另一个问题就是缩小，这可以通过``o''来实现，``o''最多可以保存5个绘图窗。

\begin{table}[H]
\centering
\caption{ppk模式命令一览表}
\label{table:plotpk-commands}
\begin{tabular}{cll}
	\toprule
    命令	&	含义	                                &   说明    \\
	\midrule
    a	    &	定义事件初至a                           &   1,7	    \\
    b	    &	如果有，则显示上一张绘图	            &           \\
    c	    &	计算事件的初至和结束                    &   1,4,7	\\
    d	    &	设置震相方向为DOWN	                    &           \\
    e     	&	设置震相起始为EMERGENT(急始)	        &           \\
    f	    &	定义事件结束f                           &  1,2,3,7	\\
    g	    &	以HYPO格式将拾取显示到终端              &   4   	\\
    h   	&	将拾取写成HYPO格式                      &   3,4 	\\
    i	    &	设置震相起始为IMPULSIVE	                &           \\
    j	    &	设置噪声水平                            &   2,6,8	\\
    l	    &	显示光标当前位置                        &   2,4	    \\
    m	    &	计算最大振幅波形                        &   2,3,5	\\
    n	    &	显示下一绘图	                        &           \\
    o	    &	显示前一个绘图窗，最多可以保存5个绘图窗	&           \\
    p	    &	定义P波到时                             &   1,2,3,7	\\
    q	    &	结束ppk模式	                            &           \\
    s	    &	定义S波到时                             &   1,2,3,7 \\
    t	    &	用户自定义到时tn，输入t之后需要输入0到9中的任一数	&   1,2,7\\
    u	    &	设置震相方向为UP	                    &           \\
    v	    &	定义一个Wood-Anderson波形               &   2,5 	\\
    w	    &	定义一个通用波形                        &   2,5 	\\
    x	    &	使用一个新的x轴时间窗，简单说就是放大。 &           \\
    z	    &	设置参考水平                            &   2,6,8	\\
    \textbackslash	    &	删除当前全部拾取的定义。当一个文件中包含多个事件时有用。&	\\
    +	    &	设置震相方向为PLUS	                    &           \\
    -	    &	设置震相方向为MINUS	                    &           \\
    \lstinline[showspaces]{ }   &	设置震相方向为NEUTRAL	                &           \\
    n	    &	设置震相质量为n，n取0-4	                &           \\
	\bottomrule
\end{tabular}
\end{table}

关于说明的说明：
\begin{enumerate}
\item 写入SAC头段
\item 写入字符数字型震相拾取文件（如果已打开）
\item 写入HYPO震相拾取文件（如果已打开）
\item 写入终端
\item 在参考水平处放置水平光标，第一个最值处放置垂直光标。终端回显包含波形的盒子
\item 在指定的水平处放置水平光标
\item 终端回显有标签的垂直线
\item 终端回显有标签的水平线
\end{enumerate}

当只有一个波形时：
\begin{SACCode}
SAC> fg seis
SAC> ppk
// 键入``t0''标记到时
SAC> wh         // 保存头段
\end{SACCode}

当有多个波形时，一般每次只显示若干个：
\begin{SACCode}
SAC> dg sub teleseis ntkl.z nykl.z onkl.z sdkl.z
SAC> ppk p 1    // 每次显示1个波形
// 键入``n''显示下一个波形，键入``b''显示上一个波形
// 键入``t0''标记到时
SAC> wh
SAC> q
\end{SACCode}

当有多个波形时，每次显示三分量，且希望一次性标记三个分量的到时：
\begin{SACCode}
SAC> dg sub teleseis ntkl.[nez] nykl.[nez] onkl.[nez] sdkl.[nez]
SAC> ppk p 3 r m
// 键入``t0''标记到时，此时键入一次``t0''可以标记当前显示的全部波形
SAC> wh
SAC> q
\end{SACCode}
